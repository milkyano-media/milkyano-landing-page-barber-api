generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  CUSTOMER
  ADMIN
}

enum OAuthProvider {
  GOOGLE
  APPLE
  FACEBOOK
}

enum ParameterType {
  STRING
  NUMBER
  BOOLEAN
  COLOR
  JSON
  IMAGE_URL
  URL
}

enum ParameterCategory {
  THEME
  BRANDING
  LAYOUT
  CONTENT
  FEATURE_FLAG
  SEO
  ANALYTICS
  CONTACT
  BOOKING
}

model User {
  id                String    @id @default(uuid())
  squareupId        String?   @unique // Square customer ID
  role              Role      @default(CUSTOMER)
  phoneNumber       String?   @unique // Made optional for OAuth users
  email             String?   @unique
  firstName         String
  lastName          String
  password          String?   // Hashed password (nullable for backward compatibility)
  isVerified        Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // OAuth relationships
  oauthAccounts     OAuthAccount[]
  
  @@index([phoneNumber])
  @@index([email])
  @@index([role])
  @@index([squareupId])
  @@map("users")
}

model OAuthAccount {
  id            String        @id @default(uuid())
  userId        String
  provider      OAuthProvider
  providerId    String        // OAuth provider's user ID (e.g., Google ID)
  providerEmail String?       // Email from OAuth provider
  accessToken   String?       // OAuth access token
  refreshToken  String?       // OAuth refresh token
  tokenExpiry   DateTime?     // Token expiration time
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  // Relations
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([provider, providerId])
  @@index([userId])
  @@index([provider])
  @@map("oauth_accounts")
}

model Parameter {
  id          String            @id @default(uuid())
  key         String            @unique
  value       Json              // Flexible storage for any value type
  type        ParameterType
  category    ParameterCategory
  description String?
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([key])
  @@map("parameters")
}